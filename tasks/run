#!/usr/bin/env node
const args = process.argv;
const path = require('path');
const colors = require('colors/safe');
const {runTask} = require('./lib/utils');

const tasks = {
  ['dev']: {
    cmd: path.join(`tasks/dev.js`),
    desc: `Starts the server and other dev related tasks.`
  },
  ['dev-scripts']: {
    cmd: path.join(`tasks/dev-scripts.js`),
    desc: `Watch js files and output to dev-dist/js`
  },
  ['api-server']: {
    cmd: path.join(`tasks/api-server.js`),
    desc: `Start the api server.`
  },
  ['sync']: {
    cmd: path.join(`tasks/sync.js`),
    desc: `Starts the dev browsersync server.`
  },
  ['watch-css']: {
    cmd: path.join(`tasks/watch-css.js`),
    desc: `Watch sass files and build on change and output to dev-dist/css`
  },
  ['build']: {
    cmd: path.join(`tasks/build.js`),
    desc: `Build the app for production and output to dist.`
  },
};

const taskName = args[2];

if(!taskName) {
  console.log(`
    ${colors.yellow(`A simple cross platform task runner for Minimal Client.`)}

    ${colors.cyan(`Usage:`)}

      ./tasks/run <task name>

    ${colors.cyan(`Example:`)}

      ./tasks/run build

    ${colors.cyan(`Available Tasks:`)}

${Object.keys(tasks).map(v => {
  return `\t${v}: ${tasks[v].desc}`;
}).join('\n')}

    `);
} else {
  runTask(tasks[taskName].cmd, `Failed to run the ${taskName} task.`);
}
